<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emily's Magical Spelling Game</title>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <!-- Lucide Icons -->
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.263.1/dist/umd/lucide.min.js"></script>

    <!-- External Stylesheets -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/game.css">
</head>
<body>
    <!-- ==================== AUTHENTICATION SCREEN ==================== -->
    <div id="authScreen" class="auth-container">
        <div class="auth-box">
            <h1>Welcome!</h1>
            <p id="authSubtext">First time here? Create an account below!</p>

            <input type="email" id="authEmail" class="auth-input" placeholder="Email" />
            <input type="password" id="authPassword" class="auth-input" placeholder="Password" />

            <button class="auth-button primary" onclick="signIn()">Log In</button>
            <button class="auth-button secondary" onclick="createAccount()">Create New Account</button>

            <div class="auth-link" onclick="forgotPassword()">Forgot Password?</div>

            <div id="authMessage" style="margin-top: 15px; padding: 10px; border-radius: 10px; display: none;"></div>
        </div>
    </div>

    <!-- ==================== GAME SCREEN ==================== -->
    <div id="gameScreen" style="display: none;">
        <!-- Navigation Buttons -->
        <button class="progress-button" onclick="openProgressDashboard()">
            <i data-lucide="bar-chart-3"></i>
            Progress
        </button>
        <a href="index.html" class="home-button">
            <i data-lucide="home"></i>
            Home
        </a>

        <div class="container">
            <!-- Header -->
            <div class="header">
                <h1>Emily's Magical Spelling Game</h1>
            </div>

            <!-- Mode Selector -->
            <div class="mode-selector">
                <button class="mode-button study active" onclick="setMode('study')">
                    <i data-lucide="book-open"></i>
                    Learn New Words
                </button>
                <button class="mode-button test" onclick="setMode('test')">
                    <i data-lucide="pencil-line"></i>
                    Spelling Test
                </button>
                <button class="mode-button action" onclick="setMode('action')">
                    <i data-lucide="activity"></i>
                    Move & Spell
                </button>
            </div>

            <!-- Game Area -->
            <div class="game-area">
                <div class="progress-info" id="progressInfo"></div>

                <!-- Step Indicator (for Learn Mode) -->
                <div class="step-indicator" id="stepIndicator" style="display: none;">
                    <div class="step" data-step="listen">
                        <div class="step-circle">1</div>
                        <div class="step-label">Listen</div>
                    </div>
                    <div class="step-arrow">→</div>
                    <div class="step" data-step="trace">
                        <div class="step-circle">2</div>
                        <div class="step-label">Trace</div>
                    </div>
                    <div class="step-arrow">→</div>
                    <div class="step" data-step="type">
                        <div class="step-circle">3</div>
                        <div class="step-label">Type</div>
                    </div>
                </div>

                <!-- Animal Display -->
                <div class="animal-container" id="animalContainer">
                    <svg class="animal-svg" id="animalSVG" viewBox="0 0 200 200"></svg>
                </div>
                
                <!-- Word Display -->
                <div class="word-display" id="wordDisplay">Ready to learn!</div>
                
                <!-- Contextual Instruction (for Learn Mode) -->
                <div class="contextual-instruction" id="contextualInstruction" style="display: none;">
                    <p id="instructionText">Listen carefully to the word!</p>
                </div>

                <!-- Speak Button -->
                <button class="speak-button" onclick="speakCurrentWord()">
                    <i data-lucide="volume-2"></i>
                    <span>Hear the Word</span>
                </button>

                <!-- Step Control Buttons (for Learn Mode) -->
                <div class="step-controls" id="stepControls" style="display: none;">
                    <button class="step-button primary" id="primaryStepButton" onclick="advanceStep()">
                        <span>Ready to Trace!</span>
                        <i data-lucide="arrow-right"></i>
                    </button>
                    <button class="step-button secondary" id="skipButton" onclick="skipToType()" style="display: none;">
                        <span>I know this word!</span>
                        <i data-lucide="zap"></i>
                    </button>
                </div>

                <!-- Action Mode Elements -->
                <div class="action-instruction" id="actionInstruction" style="display: none;"></div>
                <div class="action-demo" id="actionDemo" style="display: none;"></div>

                <!-- Tracing Area -->
                <div class="tracing-area" id="tracingArea">
                    <p style="text-align: center; color: var(--ios-blue); margin-bottom: 10px; font-size: 1.2rem; font-family: var(--font-apple); font-weight: var(--weight-semibold);">
                        Trace the letters with your finger
                    </p>
                    <canvas id="tracingCanvas" class="tracing-canvas" width="600" height="200"></canvas>
                    <button class="clear-trace-button" onclick="clearTracing()">Clear & Try Again</button>
                </div>

                <!-- Letter Boxes -->
                <div class="letter-boxes" id="letterBoxes"></div>

                <!-- Input Area -->
                <div class="input-area">
                    <h3 class="input-heading">Type what you hear</h3>
                    <input
                        type="text"
                        class="spelling-input"
                        id="spellingInput"
                        placeholder="Type the word here..."
                        autocomplete="off"
                        readonly
                    />
                </div>

                <!-- On-screen Keyboard -->
                <div class="on-screen-keyboard" id="onScreenKeyboard">
                    <div class="keyboard-row">
                        <button class="key-button" data-key="Q">Q</button>
                        <button class="key-button" data-key="W">W</button>
                        <button class="key-button" data-key="E">E</button>
                        <button class="key-button" data-key="R">R</button>
                        <button class="key-button" data-key="T">T</button>
                        <button class="key-button" data-key="Y">Y</button>
                        <button class="key-button" data-key="U">U</button>
                        <button class="key-button" data-key="I">I</button>
                        <button class="key-button" data-key="O">O</button>
                        <button class="key-button" data-key="P">P</button>
                    </div>
                    <div class="keyboard-row">
                        <button class="key-button" data-key="A">A</button>
                        <button class="key-button" data-key="S">S</button>
                        <button class="key-button" data-key="D">D</button>
                        <button class="key-button" data-key="F">F</button>
                        <button class="key-button" data-key="G">G</button>
                        <button class="key-button" data-key="H">H</button>
                        <button class="key-button" data-key="J">J</button>
                        <button class="key-button" data-key="K">K</button>
                        <button class="key-button" data-key="L">L</button>
                    </div>
                    <div class="keyboard-row">
                        <button class="key-button" data-key="Z">Z</button>
                        <button class="key-button" data-key="X">X</button>
                        <button class="key-button" data-key="C">C</button>
                        <button class="key-button" data-key="V">V</button>
                        <button class="key-button" data-key="B">B</button>
                        <button class="key-button" data-key="N">N</button>
                        <button class="key-button" data-key="M">M</button>
                        <button class="key-button backspace" data-key="BACKSPACE">⌫</button>
                    </div>
                </div>

                <!-- Check Button -->
                <button class="check-button" id="checkButton" onclick="checkSpelling()">
                    <i data-lucide="check"></i>
                    <span>Check Answer</span>
                </button>
            </div>
        </div>

        <!-- Visual Effects -->
        <div class="flower-garden" id="flowerGarden"></div>
        <div class="celebration" id="celebration"></div>
        <div class="encouragement" id="encouragement"></div>
    </div>

    <!-- ==================== SETTINGS MODAL ==================== -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <h2>🌸 Parent Settings 🌸</h2>

            <div style="text-align: center; margin-top: 20px;">
                <button class="close-button" onclick="closeSettings()">❌ Close</button>
                <button class="save-button" onclick="resetProgress()" style="background: linear-gradient(135deg, #ff6b6b, #c92a2a); margin-top: 10px;">🔄 Reset Progress</button>
                <button class="save-button" onclick="logout()" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2); margin-top: 10px;">🚪 Logout</button>
                <button class="save-button" id="teacherPortalBtn" onclick="checkTeacherAccess()" style="background: linear-gradient(135deg, #4caf50, #45a049); margin-top: 10px; display: none;">👩‍🏫 Teacher Portal</button>
            </div>
        </div>
    </div>

    <!-- ==================== PROGRESS DASHBOARD MODAL ==================== -->
    <div class="modal" id="progressModal">
        <div class="modal-content" style="max-width: 600px;">
            <h2>📊 Emily's Progress Dashboard</h2>
            <div id="progressContent" style="margin: 20px 0;">
                <div style="background: linear-gradient(135deg, #ffd3f0, #ffe6f7); padding: 20px; border-radius: 15px; margin-bottom: 15px;">
                    <h3 style="margin-bottom: 10px;">📈 Overall Stats</h3>
                    <p><strong>Total Words Mastered:</strong> <span id="totalMastered">0</span></p>
                    <p><strong>Total Practice Sessions:</strong> <span id="totalSessions">0</span></p>
                    <p><strong>Accuracy Rate:</strong> <span id="accuracyRate">0%</span></p>
                    <p><strong>Flowers Bloomed:</strong> <span id="flowersCount">0</span>/20</p>
                </div>

                <div style="background: linear-gradient(135deg, #e0f7fa, #f0f9ff); padding: 20px; border-radius: 15px; margin-bottom: 15px;">
                    <h3 style="margin-bottom: 10px;">This Week's Stars</h3>
                    <div id="weeklyWords" style="font-size: 14px;"></div>
                </div>

                <div style="background: linear-gradient(135deg, #c8e6c9, #e8f5e9); padding: 20px; border-radius: 15px;">
                    <h3 style="margin-bottom: 10px;">🏆 Top Mastered Words</h3>
                    <div id="topWords" style="font-size: 14px;"></div>
                </div>
            </div>
            <div style="text-align: center;">
                <button class="close-button" onclick="closeProgressDashboard()">❌ Close</button>
            </div>
        </div>
    </div>

    <!-- ==================== EXTERNAL JAVASCRIPT ==================== -->
    <script src="js/tts.js"></script>
    <script src="js/game.js"></script>

    <!-- ==================== LUCIDE ICONS INITIALIZATION ==================== -->
    <script>
        // Initialize Lucide icons
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();

            // Re-initialize icons whenever new elements are added dynamically
            const observer = new MutationObserver(() => {
                lucide.createIcons();
            });
            observer.observe(document.body, { childList: true, subtree: true });
        }
    </script>

</body>
</html>
